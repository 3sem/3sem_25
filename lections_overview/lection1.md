Введение в курс
• Курс посвящён основным принципам построения и функционирования операционных систем.
• Обсуждение функций операционной системы и её роли в координации выполнения пользовательских программ.
Список литературы
• Основные источники: «Основа операционных систем» Владимира Ефимовича Карпова и Константина Алексеевича Конькова.
• Рекомендация второго издания книги для семинарских занятий.
• Дополнительные книги: «Линуксапи: исчерпывающее руководство» Майкла Керри, «Современные операционные системы» Эндрю и Хьюго Босса.
Структура вычислительных систем
• Обсуждение структуры современных вычислительных систем общего назначения.
• Взаимодействие пользователя с аппаратурой через запуск и исполнение программ.
Процесс запуска программы
• Пример программы, выводящей строку на печать.
• Роль компилятора в процессе компиляции и компоновки программы.
• Системные вызовы как скрытые действия под капотом операционной системы.
Зависимости
• Описание зависимостей программы от библиотек, таких как Linux VDSO, print и write.
• Linux VDSO как интерфейс к системным вызовам.
• Буферизованный вывод и операции чтения/записи.
Пространство пользователя и системные программы
• Различие между прикладными программами, работающими в пространстве пользователя, и системными программами, работающими в привилегированном режиме.
• Пример системных программ: компилятор.
Режимы работы программ
• Вопросы о режиме работы программ в контексте уровня операционной системы.
• Разделение курсов на кафедре информатики по уровням вычислительной системы.
Введение в операционные системы
• Аппаратное обеспечение изучается во втором семестре, архитектура и ассемблеры — в третьем.
• Прикладные программы рассматриваются в спецкурсах, системные программы — в курсах по системному программированию.
• Компиляторы относятся к системным программам.
Определение операционной системы
• Операционная система управляет ресурсами компьютера, предоставляя их программам.
• Пример: работа с консолью и сетевой картой происходит прозрачно для пользователя.
Изоляция и защита
• Операционная система обеспечивает изоляцию пользователей и программ друг от друга.
• В прошлом ошибки в программах приводили к остановке компьютера, теперь ОС изолирует задачи.
Виртуальное адресное пространство
• Каждому процессу предоставляется своё виртуальное адресное пространство.
• Механизм изоляции позволяет программам работать независимо друг от друга.
Переключение между задачами
• Переключение между задачами происходит незаметно для пользователя.
• ОС изолирует программы от устройств, например, от диска.
Файлы и файловые дескрипторы
• Файлы представлены в виде таблицы файловых дескрипторов.
• ОС предоставляет уровень абстракции для работы с дисками.
Ядро операционной системы
• Ядро операционной системы функционирует в привилегированном режиме.
• Вспомогательные программы и пользовательские программы обращаются к ядру за операциями.
История операционных систем
• Эволюция операционных систем началась с 1945 года с использования вакуумных ламп и перфокарт.
• Появление архитектуры фон Неймана и первых компиляторов.
Развитие алгоритмических языков и библиотек
• Развитие алгоритмических языков и использование перфолент для ввода заданий.
• Появление библиотек часто используемых подпрограмм.
Пакетная обработка и процессы
• Развитие систем пакетной обработки.
• Концепция процессов и дерево процессов, которые легли в основу современных ОС.
Разгрузка процессора
• Идея разгрузить процессор от операций ввода и вывода.
• Появление устройств, специализирующихся на вводе и выводе.
• Широкое использование магнитных дисков.
Концепции хранения программ
• Программы можно хранить не только на перфокартах, но и на жёстких дисках.
• Необходимость оповещения процессора о готовности ввода.
• Введение механизма прерываний для асинхронного обмена данными.
Мультипрограмность
• Возможность быстрого сохранения и восстановления программ.
• Планирование заданий и управление памятью.
• Сохранение и восстановление контекста программ.
Системные вызовы и разделение операционной системы
• Разделение операционной системы на пользовательский и kernel-пространства.
• Ядро имеет право выполнять привилегированные команды.
• Механизм системных вызовов для взаимодействия между пространствами.
Система разделения времени
• Выделение квантов времени для каждой программы.
• Переключение программ по истечении квантов времени.
• Роль планировщика в управлении временем выполнения программ.
Межпроцессное взаимодействие и синхронизация
• Необходимость примитивов синхронизации для обеспечения детерминизма операций.
• Использование семафоров и атомарных операций для синхронизации.
Развитие операционных систем и интерфейсов
• Простота операционных систем, например, Unix и DOS.
• Развитие графических интерфейсов и устройств ввода-вывода.
• Интеграция компьютеров в сети и появление сетевых операционных систем.
Многоядерные процессоры и системы на кристалле
• Пределы тактовой частоты и развитие многоядерных процессоров.
• Интеграция нескольких ядер в один процессор.
• Развитие систем на кристалле с архитектурой ARM.
Виртуализация и облачные технологии
• Технологии виртуализации для запуска изолирующих окружений.
• Развитие облачных технологий и глобальной компьютеризации.
• Неопределённость будущего развития компьютерных технологий.
Основные функции операционной системы
• Планирование заданий и использование процессора.
• Механизм переключения контекста и планировщик.
• Прозрачность переключения для программ.
Средства межпрограммной коммуникации
• Файлы как средство коммуникации.
• Пайпы, разделяемая память, очереди сообщений.
• Сетевые средства коммуникации, например, сокеты.
Управление памятью
• Виртуальная память и её управление.
• Возможность выделения больше памяти, чем есть на компьютере.
• Эффективность механизма виртуальной памяти.
Управление файловой системой
• Единообразная работа с разными файловыми системами.
• Интерфейс VFS в Linux для работы с разными файловыми системами.
Управление вводом-выводом
• Оптимизация использования процессора при вводе-выводе.
• Перевод процессов в состояние ожидания данных.
Обеспечение безопасности
• Реализация безопасности в операционных системах.
• Защита программ и пользователей.
Архитектура операционных систем
• Монолитное ядро: одна большая программа.
• Простота разработки и отладки на начальном этапе.
• Сложности при увеличении размера ядра.
Распределённые архитектуры
• Разбиение на уровни: интерфейс пользователя и ядро.
• Независимость уровней друг от друга.
• Преимущества для отладки и разработки.
Преимущества распределённых архитектур
• Отладка каждого уровня без знания вышележащих уровней.
• Постепенная разработка и отладка системы.
Многоуровневая топология ядра Linux
• Теоретически можно постепенно улучшать систему, отлаживая нижележащие уровни.
• На практике многоуровневая топология не всегда применима из-за взаимодействия между подсистемами.
• Пример: для получения информации о процессах не всегда нужно использовать механизм виртуальной памяти.
Проблемы многоуровневой топологии
• Многоуровневая топология может привести к снижению производительности из-за ненужных вызовов.
• В отдельных подсистемах, например, в сетевом стеке, многоуровневая топология реализована.
Микроядро и его недостатки
• Микроядро выносит основные операции в привилегированный режим, а остальное — в пространство пользователя.
• На практике микроядро оказывается самым нагруженным компонентом, что приводит к низкой производительности.
• Попытки разгрузить микроядро не всегда дают значительный прирост производительности.
Вынос межпроцессной коммуникации
• Межпроцессную коммуникацию решили вывести из микроядра в пространство пользователя.
• Для этого используются доверенные библиотеки или системные сервисы.
Архитектура с экзолором
• Экзолор — минимальное микроядро, осуществляющее только операции ввода-вывода и предоставляющее низкоуровневые интерфейсы к устройствам.
• Пользователь сам разрабатывает средства межпроцессной коммуникации, виртуальную память и планировку.
• Такие системы могут быть в десятки раз быстрее монолитных на определённых сценариях.
Плюсы и минусы различных архитектур
• Монолитное ядро: высокая скорость работы, но сложность отладки и необходимость перекомпиляции при каждом изменении.
• Многоуровневые системы: теоретически хорошо, но на практике работают медленнее и требуют перекомпиляции отдельных уровней.
• Микроядро: простота отладки, возможность подмены компонентов без перекомпиляции, но низкая производительность.
• Экзолор: экзотика, используется в больших системах для обработки сетевых пакетов в телекоме.
Гибридные системы
• Linux умеет обновлять ядро на горячую без приостановки системы.
• Windows 8 и 10 — гибридные системы, сочетающие элементы микроядра и монолитного ядра.
Микроядерные системы
• В современном мире существуют микроядерные системы, особенно во встраиваемых средах.
• Упоминается «за ядерная» система, которая мало используется.
Виртуализация и виртуальные машины
• Виртуализация позволяет запускать экземпляры операционной системы поверх другой как пользовательскую программу.
• Для эффективной работы виртуализации требуется поддержка примитивов в ядре.
• Современные операционные системы, такие как Linux, содержат компоненты ядра для виртуализации, например, KVM и Virt.
Безопасность виртуализованных окружений
• Оборудование имеет примитивы для повышения безопасности виртуализованных окружений, например, гипервизорный режим в архитектуре ARM.
• Гипервизорная виртуализация позволяет запускать целую операционную систему.
• Контейнерная виртуализация позволяет запускать несколько изолированных пользовательских пространств на одном ядре.
Реализация контейнерной виртуализации в Linux
• В Linux контейнерная виртуализация реализуется с помощью пространств имён, таких как PID, Mount, User.
• Системные вызовы clone и stripper позволяют управлять процессами внутри контейнеров.
Основы операционных систем
• Процесс — это абстракция, создающая иллюзию монопольного использования компьютера для запущенной программы.
• Поток — это поток исполнения программы, включающий содержимое регистров, стек и системные атрибуты.
• В одном процессе может быть несколько потоков, работающих параллельно в одном адресном пространстве.
Основные сервисы операционной системы
• Основные сервисы: планирование задач, управление памятью, межпроцессная коммуникация и синхронизация.
• Переключение контекста позволяет прозрачно замораживать и запускать программы без их уведомления.
Процесс загрузки компьютера
• При включении компьютера сначала запускается система тестирования памяти.
• BIOS находит первый накопитель для загрузки и записывает загрузчик операционной системы в оперативную память.
• Загрузчик подготавливает систему к запуску и настраивает системный таймер на генерацию прерываний каждый квант времени.
Технические детали прерываний
• Системный таймер генерирует прерывания каждые 20 миллисекунд.
• Контроллер прерываний APIC имеет множество входов и выходов, позволяя настраивать различные поведения.
